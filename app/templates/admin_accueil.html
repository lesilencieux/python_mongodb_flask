{% extends "admin_template.html" %}

{% block resume %}

{% if current_user.is_authenticated() and "admin" in current_user.get_roles() %}
<!-- Counts Section -->

<section class="dashboard-counts section-padding">
    <div class="container-fluid">
        <div class="row">
            <!-- Count item widget-->
            <div class="col-xl-2 col-md-4 col-6">
                <div class="wrapper count-title d-flex">
                    <div class="icon"><i class="icon-user"></i></div>
                    <div class="name"><strong class="text-uppercase">Agents</strong><span>enregistrés</span>
                        <div class="count-number">{{nb_agent}}</div>
                    </div>
                </div>
            </div>
            <!-- Count item widget-->
            <div class="col-xl-2 col-md-4 col-6">
                <div class="wrapper count-title d-flex">
                    <div class="icon"><i class="icon-list"></i></div>
                    <div class="name"><strong class="text-uppercase">Objets</strong><span>créés</span>
                        <div class="count-number">{{nb_total_object}}</div>
                    </div>
                </div>
            </div>
            <!-- Count item widget-->
            <div class="col-xl-2 col-md-4 col-6">
                <div class="wrapper count-title d-flex">
                    <div class="icon"><i class="icon-padnote"></i></div>
                    <div class="name"><strong class="text-uppercase">Missions</strong><span>enregistrées</span>
                        <div class="count-number">{{nb_total_mission}}</div>
                    </div>
                </div>
            </div>
            <!-- Count item widget-->
            <div class="col-xl-2 col-md-4 col-6">
                <div class="wrapper count-title d-flex">
                    <div class="icon"><i class="icon-bill"></i></div>
                    <div class="name"><strong class="text-uppercase">Missions</strong><span>réalisées</span>
                        <div class="count-number">{{nb_total_mission_validee}}</div>
                    </div>
                </div>
            </div>

            <!-- Count item widget-->
            <div class="col-xl-2 col-md-4 col-6">
                <div class="wrapper count-title d-flex">
                    <div class="icon"><i class="icon-list-1"></i></div>
                    <div class="name"><strong class="text-uppercase">Missions</strong><span>rejetées</span>
                        <div class="count-number">{{nb_total_mission_rejete}}</div>
                    </div>
                </div>
            </div>
            <!-- Count item widget-->
            <div class="col-xl-2 col-md-4 col-6">
                <div class="wrapper count-title d-flex">
                    <div class="icon"><i class="icon-check"></i></div>
                    <div class="name"><strong class="text-uppercase">Missions</strong><span>A valider</span>
                        <div class="count-number">{{nb_total_mission_en_attente}}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% else %}
<!-- Counts Section -->
<section class="dashboard-counts section-padding">
    <div class="container-fluid">
        <div class="row">
            <!-- Count item widget-->
            <div class="offset-sm-1 col-xl-3 col-md-3 col-12">
                <div class="wrapper count-title d-flex">
                    <div class="icon"><i class="icon-list"></i></div>
                    <div class="name"><strong class="text-uppercase">Objets</strong><span>créés</span>
                        <div class="count-number">{{nb_total_object}}</div>
                    </div>
                </div>
            </div>
            <!-- Count item widget-->
            <div class="offset-sm-1 col-xl-3 col-md-3 col-12">
                <div class="wrapper count-title d-flex">
                    <div class="icon"><i class="icon-padnote"></i></div>
                    <div class="name"><strong class="text-uppercase">Missions</strong><span>enregistrées</span>
                        <div class="count-number">{{nb_total_mission}}</div>
                    </div>
                </div>
            </div>
            <!-- Count item widget-->
            <div class="offset-sm-1 col-xl-3 col-md-3 col-12">
                <div class="wrapper count-title d-flex">
                    <div class="icon"><i class="icon-bill"></i></div>
                    <div class="name"><strong class="text-uppercase">Missions</strong><span>réalisées</span>
                        <div class="count-number">{{nb_total_mission_validee}}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endif %}

{% endblock %}

{% block content %}

<section>
    <div class="container-fluid">
        <!-- Page Header-->
        <!-- <header>
            <h1 class="h3 display">Liste des missions</h1>
        </header> -->
        <div class="row">
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-header">
                        <h4>Récapitulatif des missions</h4>
                    </div>
                    <div class="card-body col-md-12">
                        <div class="table-responsive">
                            <table id="example" class="table table-striped table-hover">
                                <thead>
                                <tr>
                                    <th>Réference Ordre Mission</th>
                                    <th>Structure Initiatrice</th>
                                    <th>Date Création</th>
                                    <th>Date De Départ</th>
                                    <th>Date Date Retour</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                                </thead>
                                <tbody>

                                {% for mission in list_missions %}
                                <tr>
                                    <td class="table-active">{{ mission['reference_ordre_mission'] }}</td>
                                    <td class="table-primary">{{ mission['structure_initiatrice_mission'] }}</td>
                                    <td class="table-secondary">{{ mission['created_at'] }}</td>
                                    <td class="table-success">{{ mission['date_depart_mission'] }}</td>
                                    <td class="table-danger">{{ mission['date_retour_mission'] }}</td>
                                    <td class="table-warning">{{ mission['status_mission'] }}</td>
                                    <td>
                                        <div class="input-group btn">
                                            <button type="button" class="btn btn-success  dropdown-toggle pull-right"
                                                    data-toggle="dropdown">
                                                Actions
                                            </button>
                                            {% if 'admin' in current_user._roles %}
                                            {% if mission['status_mission'] == 'Validee' %}
                                            <ul class="dropdown-menu">
                                                <li>
                                                    <a href="/mission/{{ mission['_id'] }}/{{ current_user.get_username() }}/{{ current_user.get_email() }}/{{ current_user.get_roles() }}">
                                                        <button class="btn btn-info btn-block">Afficher</button>
                                                    </a></li>
                                                <li><a href="/ordre_de_mission/{{ mission['_id'] }}">
                                                    <button class="btn btn-warning btn-block">OM</button>
                                                </a></li>
                                                <!--                                        <li><a href="/delete_mission/{{ mission['_id'] }}">-->
                                                <!--                                            <button class="btn btn-danger btn-block">Supprimer</button>-->
                                                <!--                                        </a></li>-->
                                                <li class="divider"></li>

                                            </ul>
                                            {% else %}
                                            <ul class="dropdown-menu">
                                                <li>
                                                    <a href="/mission/{{ mission['_id'] }}/{{ current_user.get_username() }}/{{ current_user.get_email() }}/{{ current_user.get_roles() }}">
                                                        <button class="btn btn-info btn-block">Afficher</button>
                                                    </a></li>
                                                <li>
                                                    <a href="validate_mission/{{ mission['_id'] }}/{{ current_user.get_username() }}/{{ current_user.get_email() }}/{{ current_user.get_roles() }}">
                                                        <button class="btn btn-primary btn-block">Valider</button>
                                                    </a></li>
                                                <!--                                <li><a href="#">-->
                                                <!--                                    <button class="btn btn-dark btn-block">Rejeter</button>-->
                                                <!--                                </a></li>-->
                                                <li>
                                                    <a href="/update_mission/{{ mission['_id'] }}/{{ current_user.get_username() }}/{{ current_user.get_email() }}/{{ current_user.get_roles() }}">
                                                        <button class="btn btn-warning btn-block">Modifier</button>
                                                    </a></li>
                                                <!--                                        <li><a href="/delete_mission/{{ mission['_id'] }}">-->
                                                <!--                                            <button class="btn btn-danger btn-block">Supprimer</button>-->
                                                <!--                                        </a></li>-->
                                                <li class="divider"></li>

                                            </ul>
                                            {% endif %}
                                            {% else %}
                                            {% if mission['status_mission'] == 'Validee' %}
                                            <ul class="dropdown-menu">
                                                <li>
                                                    <a href="/mission/{{ mission['_id'] }}/{{ current_user.get_username() }}/{{ current_user.get_email() }}/{{ current_user.get_roles() }}">
                                                        <button class="btn btn-info btn-block">Afficher</button>
                                                    </a></li>
                                                <li><a href="/ordre_de_mission/{{ mission['_id'] }}">
                                                    <button class="btn btn-warning btn-block">OM</button>
                                                </a></li>
                                                <li class="divider"></li>

                                            </ul>
                                            {% else %}
                                            <ul class="dropdown-menu">
                                                <li>
                                                    <a href="/mission/{{ mission['_id'] }}/{{ current_user.get_username() }}/{{ current_user.get_email() }}/{{ current_user.get_roles() }}">
                                                        <button class="btn btn-info btn-block">Afficher</button>
                                                    </a></li>

                                                <li>
                                                    <a href="/update_mission/{{ mission['_id'] }}/{{ current_user.get_username() }}/{{ current_user.get_email() }}/{{ current_user.get_roles() }}">
                                                        <button class="btn btn-warning btn-block">Modifier</button>
                                                    </a></li>

                                                <li class="divider"></li>

                                            </ul>
                                            {% endif %}
                                            {% endif %}
                                        </div>
                                    </td>
                                </tr>
                                </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- <section class="dashboard-header section-padding">
	<div class="container-fluid">
		<div class="row d-flex align-items-md-stretch">

		</div>
	</div>
</section> -->

<script type="text/javascript">
    document.getElementById("accueil").className = "active";

</script>

{% endblock %}